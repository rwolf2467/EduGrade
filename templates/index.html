<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="Content-Security-Policy"
        content="default-src 'self'; script-src 'self' 'unsafe-inline' https://cdn.jsdelivr.net; style-src 'self' 'unsafe-inline' https://cdn.jsdelivr.net; img-src 'self' data:; font-src 'self' https://cdn.jsdelivr.net; connect-src 'self';">
    <meta http-equiv="X-Content-Type-Options" content="nosniff">
    <meta http-equiv="X-Frame-Options" content="DENY">
    <meta name="referrer" content="strict-origin-when-cross-origin">
    <title>EduGrade</title>
    <link rel="icon" type="image/png" href="/static/logo.svg">
    <link rel="manifest" href="/static/manifest.json">
    <meta name="theme-color" content="#9333ea">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="EduGrade">
    <link rel="apple-touch-icon" href="/static/icons/icon-192.png">
    <script src="https://cdn.jsdelivr.net/npm/@tailwindcss/browser@4"></script>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/basecoat-css@0.3.10-beta.2/dist/basecoat.cdn.min.css">
    <script src="https://cdn.jsdelivr.net/npm/basecoat-css@0.3.10-beta.2/dist/js/all.min.js" defer></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chartjs-adapter-date-fns@3"></script>
    <script src="https://cdn.jsdelivr.net/npm/jspdf@2.5.1/dist/jspdf.umd.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/html2canvas@1.4.1/dist/html2canvas.min.js"></script>
    <link rel="stylesheet" href="/static/css/style.css">
    <script src="/static/scripts/theme.js"></script>
</head>

<body>
    <!-- Store current user info and app version -->
    <script>
        window.currentUser = {
            id: '{{ user.id }}',
            username: "{{ user.username }}",
            email: "{{ user.email }}"
        };
        window.appVersion = '{{ app_version }}';
    </script>

    <div id="toaster" class="toaster"></div>

    <div id="app">
        <!-- Setup Page -->
        <div id="setup-page" class="fixed inset-0 z-50 flex items-center justify-center bg-opacity-50">
            <dialog id="setup-dialog" class="dialog w-full sm:max-w-[425px]" open>
                <div>
                    <header>
                        <img src="/static/logo.svg" alt="EduGrade Logo" class="mx-auto mb-3"
                            style="height: 48px; width: auto;">
                        <h2 data-i18n="setup.welcome">Welcome!</h2>
                        <p data-i18n="setup.welcomeText">Welcome to EduGrade! A tool to help you manage and track
                            student grades effectively.</p>
                    </header>
                    <section>
                        <form id="setup-form" class="form grid gap-6">
                            <div class="grid gap-2">
                                <p class="text-lg font-medium">Welcome, <span class="text-primary font-semibold">{{
                                        user.username }}</span>!</p>
                                <p class="text-sm" style="color: oklch(.708 0 0);" data-i18n="setup.welcomeSubtext">
                                    Great to have you here! Let's set up
                                    your first classroom.</p>
                            </div>
                            <div class="grid gap-2">
                                <label for="class-name" data-i18n="setup.className">Class name (e.g., "1A")</label>
                                <input type="text" id="class-name" class="input" value="1A">
                                <p class="text-sm" style="color: oklch(.708 0 0);" data-i18n="setup.classHint">Create
                                    your first class. You can
                                    always add more or make changes later.</p>
                            </div>
                            <div class="grid gap-2">
                                <label for="setup-theme" data-i18n="setup.theme">Theme</label>
                                <div class="flex gap-2">
                                    <button type="button" id="setup-theme-light"
                                        class="btn-outline flex-1 flex items-center justify-center gap-2">
                                        <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20"
                                            viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"
                                            stroke-linecap="round" stroke-linejoin="round">
                                            <circle cx="12" cy="12" r="4" />
                                            <path d="M12 2v2" />
                                            <path d="M12 20v2" />
                                            <path d="m4.93 4.93 1.41 1.41" />
                                            <path d="m17.66 17.66 1.41 1.41" />
                                            <path d="M2 12h2" />
                                            <path d="M20 12h2" />
                                            <path d="m6.34 17.66-1.41 1.41" />
                                            <path d="m19.07 4.93-1.41 1.41" />
                                        </svg>
                                        <span data-i18n="setup.themeLight">Light</span>
                                    </button>
                                    <button type="button" id="setup-theme-dark"
                                        class="btn-outline flex-1 flex items-center justify-center gap-2">
                                        <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20"
                                            viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"
                                            stroke-linecap="round" stroke-linejoin="round">
                                            <path d="M12 3a6 6 0 0 0 9 9 9 9 0 1 1-9-9Z" />
                                        </svg>
                                        <span data-i18n="setup.themeDark">Dark</span>
                                    </button>
                                </div>
                                <p class="text-sm" style="color: oklch(.708 0 0);" data-i18n="setup.themeHint">Choose
                                    your preferred theme. You can change this anytime.</p>
                            </div>
                            <div class="grid gap-2">
                                <label data-i18n="profile.language">Language</label>
                                <div class="flex gap-2">
                                    <button type="button" id="setup-lang-en"
                                        class="btn-outline flex-1 flex items-center justify-center gap-2">
                                        English
                                    </button>
                                    <button type="button" id="setup-lang-de"
                                        class="btn-outline flex-1 flex items-center justify-center gap-2">
                                        Deutsch
                                    </button>
                                </div>
                                <p class="text-sm" style="color: oklch(.708 0 0);" data-i18n="profile.languageHint">
                                    Choose your preferred language.</p>
                            </div>
                    </section>
                    <footer class="flex justify-end gap-2">
                        <button type="button" class="btn-outline" id="import-setup"
                            data-i18n="setup.import">Import</button>
                        <button type="submit" class="btn-primary" data-i18n="setup.letsGo">Let's go</button>
                    </footer>
                    </form>
                </div>
            </dialog>
        </div>

        <!-- Import Dialog -->
        <dialog id="import-dialog" class="dialog w-full sm:max-w-[425px]">
            <div>
                <header>
                    <h2 data-i18n="import.title">Import Data</h2>
                </header>
                <section>
                    <form id="import-form" class="form grid gap-6">
                        <div class="grid gap-2">
                            <label for="import-file" data-i18n="import.selectFile">Select JSON File</label>
                            <input type="file" id="import-file" class="input" accept=".json" required>
                        </div>
                    </form>
                </section>
                <footer class="flex justify-end gap-2">
                    <button type="button" class="btn-outline" id="cancel-import"
                        data-i18n="dialog.cancel">Cancel</button>
                    <button type="button" class="btn-primary" id="confirm-import"
                        data-i18n="import.import">Import</button>
                </footer>
            </div>
        </dialog>
        <dialog id="alert-dialog" class="dialog w-full sm:max-w-[425px]" aria-labelledby="alert-dialog-title"
            onclick="if (event.target === this) this.close()">
            <div>
                <header>
                    <h2 id="alert-dialog-title" data-i18n="dialog.alert">Alert</h2>
                </header>
                <section class="flex gap-3 items-start">
                    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none"
                        stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"
                        class="text-yellow-500 flex-shrink-0 mt-0.5">
                        <path d="m21.73 18-8-14a2 2 0 0 0-3.48 0l-8 14A2 2 0 0 0 4 21h16a2 2 0 0 0 1.73-3" />
                        <path d="M12 9v4" />
                        <path d="M12 17h.01" />
                    </svg>
                    <p id="alert-message"></p>
                </section>
                <footer class="flex justify-end gap-2">
                    <button type="button" class="btn-primary" id="close-alert" data-i18n="dialog.okay">Okay</button>
                </footer>
            </div>
        </dialog>
        <!-- Main Dashboard -->
        <div id="dashboard" class="hidden">
            <aside class="sidebar" data-side="left" aria-hidden="false">
                <nav aria-label="Sidebar navigation">
                    <section class="scrollbar">
                        <div role="group" aria-labelledby="group-label-home" class="w-full">
                            <h3 id="group-label-home" data-i18n="nav.navigation">Navigation</h3>
                            <ul class="w-full">
                                <li class="w-full">
                                    <button id="nav-home" class="btn-block btn-primary mb-2 w-full">
                                        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24"
                                            viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"
                                            stroke-linecap="round" stroke-linejoin="round">
                                            <path d="m3 9 9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z" />
                                            <polyline points="9 22 9 12 15 12 15 22" />
                                        </svg>
                                        <span data-i18n="nav.home">Home</span>
                                    </button>
                                </li>
                            </ul>
                        </div>
                        <div role="group" aria-labelledby="group-label-content-1" class="w-full">
                            <h3 id="group-label-content-1" data-i18n="nav.classes">Classes</h3>
                            <ul class="w-full">
                                <li class="w-full">
                                    <button id="add-class" class="btn-block btn-secondary mb-2 w-full">
                                        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24"
                                            viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"
                                            stroke-linecap="round" stroke-linejoin="round">
                                            <path d="m7 11 2-2-2-2" />
                                            <path d="M11 13h4" />
                                            <rect width="18" height="18" x="3" y="3" rx="2" ry="2" />
                                        </svg>
                                        <span data-i18n="nav.addClass">Add Class</span>
                                    </button>
                                </li>
                                <li class="w-full">
                                    <div id="class-list" class="space-y-1 w-full"></div>
                                </li>
                                <li class="w-full mt-2">
                                    <button id="manage-categories" class="btn-block btn-secondary w-full">
                                        <svg class="lucide lucide-settings" viewBox="0 0 24 24" fill="none"
                                            stroke="currentColor">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                                d="M10.5 6h9.75M10.5 6a1.5 1.5 0 1 1-3 0m3 0a1.5 1.5 0 1 0-3 0M3.75 6H7.5m3 12h9.75m-9.75 0a1.5 1.5 0 0 1-3 0m3 0a1.5 1.5 0 0 0-3 0m-3.75 0H7.5m9-6h3.75m-3.75 0a1.5 1.5 0 0 1-3 0m3 0a1.5 1.5 0 0 0-3 0m-3.75 0h-3.75" />
                                        </svg>
                                        <span data-i18n="nav.gradeSettings">Grade Settings</span>
                                    </button>
                                </li>
                            </ul>
                        </div>
                    </section>
                    <section class="mt-auto pt-4 flex justify-end">
                        <div role="group" aria-labelledby="group-label-content-2" class="w-full">
                            <h3 id="group-label-content-2" class="sr-only" data-i18n="nav.actions">Actions</h3>
                            <div role="group" class="button-group w-full" data-orientation="vertical">
                                <button id="export-data" class="btn-outline w-full">
                                    <svg class="lucide lucide-download" viewBox="0 0 24 24" fill="none"
                                        stroke="currentColor">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                            d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4" />
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                            d="M7 10l5 5 5-5" />
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                            d="M12 15V3" />
                                    </svg>
                                    <span data-i18n="nav.export">Export</span>
                                </button>
                                <button id="profile-btn" class="btn-outline w-full">
                                    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"
                                        fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                                        stroke-linejoin="round">
                                        <path d="M19 21v-2a4 4 0 0 0-4-4H9a4 4 0 0 0-4 4v2" />
                                        <circle cx="12" cy="7" r="4" />
                                    </svg>
                                    <span data-i18n="nav.profile">Profile</span>
                                </button>
                                <button id="logout-btn" class="btn-outline w-full">
                                    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"
                                        fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                                        stroke-linejoin="round">
                                        <path d="M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4" />
                                        <polyline points="16 17 21 12 16 7" />
                                        <line x1="21" y1="12" x2="9" y2="12" />
                                    </svg>
                                    <span data-i18n="nav.logout">Logout</span>
                                </button>
                            </div>
                            <div class="flex gap-2 mt-4 w-full">
                                <a href="/about.html" class="btn-outline flex-1">
                                    <svg class="lucide" viewBox="0 0 24 24" fill="none" stroke="currentColor">
                                        <circle cx="12" cy="12" r="10" stroke-width="2" />
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                            d="M12 16v-4M12 8h.01" />
                                    </svg>
                                    <span data-i18n="nav.about">About</span>
                                </a>
                                <button type="button" aria-label="Toggle dark mode" data-tooltip="Toggle dark mode"
                                    data-i18n-tooltip="nav.toggleDarkMode" data-side="left"
                                    onclick="document.dispatchEvent(new CustomEvent('basecoat:theme'))"
                                    class="btn-icon-outline size-8">
                                    <span class="hidden dark:block"><svg xmlns="http://www.w3.org/2000/svg" width="24"
                                            height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                                            stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                            <circle cx="12" cy="12" r="4" />
                                            <path d="M12 2v2" />
                                            <path d="M12 20v2" />
                                            <path d="m4.93 4.93 1.41 1.41" />
                                            <path d="m17.66 17.66 1.41 1.41" />
                                            <path d="M2 12h2" />
                                            <path d="M20 12h2" />
                                            <path d="m6.34 17.66-1.41 1.41" />
                                            <path d="m19.07 4.93-1.41 1.41" />
                                        </svg></span>
                                    <span class="block dark:hidden"><svg xmlns="http://www.w3.org/2000/svg" width="24"
                                            height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                                            stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                            <path d="M12 3a6 6 0 0 0 9 9 9 9 0 1 1-9-9Z" />
                                        </svg></span>
                                </button>
                            </div>
                        </div>
                    </section>
                </nav>
            </aside>

            <main>
                <div class="flex items-center justify-between">
                    <div class="flex items-center gap-2">
                        <button type="button" onclick="document.dispatchEvent(new CustomEvent('basecoat:sidebar'));"
                            class="btn-outline" data-tooltip="Toggle sidebar" data-i18n-tooltip="nav.toggleSidebar"
                            data-side="right">
                            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"
                                fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                                stroke-linejoin="round">
                                <path d="M3 6h18" />
                                <path d="M3 12h18" />
                                <path d="M3 18h18" />
                            </svg>
                        </button>

                        <h2 class="text-xl font-semibold" id="greeting">Hello, <span id="teacher-greeting"></span>!</h2>
                    </div>
                </div>
                <dialog id="clear-storage-dialog" class="dialog w-full sm:max-w-[425px]"
                    aria-labelledby="clear-storage-dialog-title">
                    <div>
                        <header>
                            <h2 data-i18n="profile.clearAllData">Clear All Data</h2>
                        </header>
                        <section class="flex gap-3 items-start">
                            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"
                                fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                                stroke-linejoin="round" class="text-red-500 flex-shrink-0 mt-0.5">
                                <path d="m21.73 18-8-14a2 2 0 0 0-3.48 0l-8 14A2 2 0 0 0 4 21h16a2 2 0 0 0 1.73-3" />
                                <path d="M12 9v4" />
                                <path d="M12 17h.01" />
                            </svg>
                            <div>
                                <p class="mb-2"><strong data-i18n="profile.clearAllDataWarning">This will delete all
                                        your data from the server!</strong></p>
                                <p class="text-sm" style="color: oklch(.708 0 0);" data-i18n="profile.clearAllDataHint">
                                    All classes, students, and grades
                                    will be permanently deleted. Please export your data first if you want to keep a
                                    backup. This action cannot be undone.</p>
                            </div>
                        </section>
                        <footer class="flex justify-end gap-2">
                            <button type="button" class="btn-outline" id="cancel-clear-storage"
                                data-i18n="dialog.cancel">Cancel</button>
                            <button type="button" class="btn-destructive" id="confirm-clear-storage">
                                <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"
                                    fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                                    stroke-linejoin="round" class="lucide lucide-trash-icon lucide-trash">
                                    <path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6" />
                                    <path d="M3 6h18" />
                                    <path d="M8 6V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2" />
                                </svg>
                                <span data-i18n="profile.deleteAllData">Delete All Data</span>
                            </button>
                        </footer>
                        <button type="button" aria-label="Close dialog" onclick="this.closest('dialog').close()">
                            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"
                                fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                                stroke-linejoin="round">
                                <path d="M18 6 6 18" />
                                <path d="m6 6 12 12" />
                            </svg>
                        </button>
                    </div>
                </dialog>

                <!-- Profile Dialog -->
                <dialog id="profile-dialog" class="dialog w-full sm:max-w-[500px]"
                    aria-labelledby="profile-dialog-title">
                    <div>
                        <header>
                            <h2 id="profile-dialog-title" data-i18n="profile.title">Profile</h2>
                            <p class="text-sm" style="color: oklch(.708 0 0);" data-i18n="profile.subtitle">Manage your
                                profile and account settings
                            </p>
                        </header>
                        <section class="space-y-6 max-h-[60vh] overflow-y-auto">
                            <!-- Account Info -->
                            <div class="p-4 rounded-lg">
                                <h3 class="text-sm font-medium mb-2" data-i18n="profile.accountInfo">Account Information
                                </h3>
                                <div class="space-y-1 text-sm" style="color: oklch(.708 0 0);">
                                    <p><span class="font-medium" data-i18n="profile.username">Username:</span> {{
                                        user.username }}</p>
                                    <p><span class="font-medium" data-i18n="profile.email">Email:</span> {{ user.email
                                        }}</p>
                                </div>
                            </div>

                            <!-- Teacher Name -->
                            <div class="grid gap-2">
                                <label for="profile-teacher-name" class="text-sm font-medium"
                                    data-i18n="profile.displayName">Display Name</label>
                                <input type="text" id="profile-teacher-name" class="input" placeholder="Your name"
                                    data-i18n-placeholder="profile.displayNamePlaceholder">
                                <p class="text-xs" style="color: oklch(.708 0 0);" data-i18n="profile.displayNameHint">
                                    This name will be shown in the
                                    greeting message.</p>
                            </div>

                            <!-- School -->
                            <div class="grid gap-2">
                                <label for="profile-school" class="text-sm font-medium"
                                    data-i18n="profile.school">School</label>
                                <input type="text" id="profile-school" class="input"
                                    data-i18n-placeholder="profile.schoolPlaceholder" placeholder="Your school name">
                                <p class="text-xs" style="color: oklch(.708 0 0);" data-i18n="profile.schoolHint">
                                    Optional: Name of your school or
                                    educational institution.</p>
                            </div>

                            <!-- Language -->
                            <div class="grid gap-2">
                                <label for="profile-language" class="text-sm font-medium"
                                    data-i18n="profile.language">Language</label>
                                <select id="profile-language" class="select">
                                    <option value="en">English</option>
                                    <option value="de">Deutsch</option>
                                </select>
                                <p class="text-xs" style="color: oklch(.708 0 0);" data-i18n="profile.languageHint">
                                    Choose your preferred language.</p>
                            </div>

                            <!-- Danger Zone -->
                            <div class="alert-destructive p-4 rounded-lg border border-red-500/30">
                                <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"
                                    fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                                    stroke-linejoin="round"
                                    class="lucide lucide-octagon-alert-icon lucide-octagon-alert">
                                    <path d="M12 16h.01" />
                                    <path d="M12 8v4" />
                                    <path
                                        d="M15.312 2a2 2 0 0 1 1.414.586l4.688 4.688A2 2 0 0 1 22 8.688v6.624a2 2 0 0 1-.586 1.414l-4.688 4.688a2 2 0 0 1-1.414.586H8.688a2 2 0 0 1-1.414-.586l-4.688-4.688A2 2 0 0 1 2 15.312V8.688a2 2 0 0 1 .586-1.414l4.688-4.688A2 2 0 0 1 8.688 2z" />
                                </svg>
                                <h3 class="text-sm font-medium mb-3 text-red-400" data-i18n="profile.dangerZone">Danger
                                    Zone</h3>
                                <section class="space-y-3">
                                    <div class="flex items-center justify-between gap-4">
                                        <div>
                                            <p class="text-sm font-medium" data-i18n="profile.clearAllData">Clear All
                                                Data</p>
                                            <p class="text-xs" style="color: oklch(.708 0 0);"
                                                data-i18n="profile.clearDataDesc">Deletes all classes,
                                                students and grades. Your account will be preserved.</p>
                                        </div>
                                        <button type="button"
                                            class="btn-outline text-red-400 border-red-400 hover:bg-red-500/10"
                                            id="profile-clear-data" data-i18n="profile.clearData">
                                            Clear Data
                                        </button>
                                    </div>
                                    <hr class="border-red-500/20">
                                    <div class="flex items-center justify-between gap-4">
                                        <div>
                                            <p class="text-sm font-medium" data-i18n="profile.deleteAccount">Delete
                                                Account</p>
                                            <p class="text-xs" style="color: oklch(.708 0 0);"
                                                data-i18n="profile.deleteAccountDesc">Permanently deletes your
                                                account and all associated data.</p>
                                        </div>
                                        <button type="button" class="btn-destructive" id="profile-delete-account"
                                            data-i18n="profile.deleteAccount">
                                            Delete Account
                                        </button>
                                    </div>
                                </section>
                            </div>
                        </section>
                        <footer class="flex justify-end gap-2">
                            <button type="button" class="btn-outline" id="cancel-profile"
                                data-i18n="dialog.cancel">Cancel</button>
                            <button type="button" class="btn-primary" id="save-profile"
                                data-i18n="dialog.save">Save</button>
                        </footer>
                        <button type="button" aria-label="Close dialog" onclick="this.closest('dialog').close()">
                            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"
                                fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                                stroke-linejoin="round">
                                <path d="M18 6 6 18" />
                                <path d="m6 6 12 12" />
                            </svg>
                        </button>
                    </div>
                </dialog>

                <!-- Delete Account Confirmation Dialog -->
                <dialog id="delete-account-dialog" class="dialog w-full sm:max-w-[425px]"
                    aria-labelledby="delete-account-dialog-title">
                    <div>
                        <header>
                            <h2 id="delete-account-dialog-title" class="text-red-400" data-i18n="profile.deleteAccount">
                                Delete Account</h2>
                        </header>
                        <section class="flex gap-3 items-start">
                            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"
                                fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                                stroke-linejoin="round" class="text-red-500 flex-shrink-0 mt-0.5">
                                <path d="m21.73 18-8-14a2 2 0 0 0-3.48 0l-8 14A2 2 0 0 0 4 21h16a2 2 0 0 0 1.73-3" />
                                <path d="M12 9v4" />
                                <path d="M12 17h.01" />
                            </svg>
                            <div>
                                <p class="mb-2"><strong data-i18n="profile.deleteAccountWarning">This action cannot be
                                        undone!</strong></p>
                                <p class="text-sm" style="color: oklch(.708 0 0);"
                                    data-i18n="profile.deleteAccountHint">Your account and all associated data
                                    will be permanently deleted. You will be logged out immediately.</p>
                            </div>
                        </section>
                        <footer class="flex justify-end gap-2">
                            <button type="button" class="btn-outline" id="cancel-delete-account"
                                data-i18n="dialog.cancel">Cancel</button>
                            <button type="button" class="btn-destructive" id="confirm-delete-account">
                                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24"
                                    fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                                    stroke-linejoin="round">
                                    <path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6" />
                                    <path d="M3 6h18" />
                                    <path d="M8 6V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2" />
                                </svg>
                                <span data-i18n="profile.deleteAccount">Delete Account</span>
                            </button>
                        </footer>
                        <button type="button" aria-label="Close dialog" onclick="this.closest('dialog').close()">
                            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"
                                fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                                stroke-linejoin="round">
                                <path d="M18 6 6 18" />
                                <path d="m6 6 12 12" />
                            </svg>
                        </button>
                    </div>
                </dialog>

                <!-- Category Management Dialog -->
                <dialog id="category-management-dialog" class="dialog w-full sm:max-w-[425px]"
                    aria-labelledby="category-management-title">
                    <div>
                        <header>
                            <h2 id="category-management-title" data-i18n="class.manageCategories">Manage Categories</h2>
                        </header>
                        <section>
                            <div id="category-management-list" class="space-y-2"></div>
                        </section>
                        <footer class="flex justify-end gap-2">
                            <button type="button" class="btn-outline" id="close-category-management"
                                data-i18n="dialog.close">Close</button>
                        </footer>
                        <button type="button" aria-label="Close dialog" onclick="this.closest('dialog').close()"
                            data-tooltip="Close dialog" data-i18n-tooltip="dialog.closeDialog" data-side="top">
                            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"
                                fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                                stroke-linejoin="round" class="lucide lucide-x-icon lucide-x">
                                <path d="M18 6 6 18" />
                                <path d="m6 6 12 12" />
                            </svg>
                        </button>
                    </div>
                </dialog>

                <!-- Home View -->
                <section id="home-view" class="mt-10">
                    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4 mb-6">
                        <div class="card">
                            <div class="flex items-center gap-3 p-4">
                                <div class="p-3 rounded-lg bg-blue-100">
                                    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"
                                        fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                                        stroke-linejoin="round" class="text-blue-600">
                                        <path d="M18 21a8 8 0 0 0-16 0" />
                                        <circle cx="10" cy="8" r="5" />
                                        <path d="M22 20c0-3.37-2-6.5-4-8a5 5 0 0 0-.45-8.3" />
                                    </svg>
                                </div>
                                <div>
                                    <p class="text-sm" style="color: oklch(.708 0 0);" data-i18n="home.totalClasses">
                                        Total Classes</p>
                                    <p class="text-2xl font-bold" id="stat-total-classes">0</p>
                                </div>
                            </div>
                        </div>
                        <div class="card">
                            <div class="flex items-center gap-3 p-4">
                                <div class="p-3 rounded-lg bg-green-100">
                                    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"
                                        fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                                        stroke-linejoin="round" class="text-green-600">
                                        <path d="M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2" />
                                        <circle cx="9" cy="7" r="4" />
                                        <path d="M22 21v-2a4 4 0 0 0-3-3.87" />
                                        <path d="M16 3.13a4 4 0 0 1 0 7.75" />
                                    </svg>
                                </div>
                                <div>
                                    <p class="text-sm" style="color: oklch(.708 0 0);" data-i18n="home.totalStudents">
                                        Total Students</p>
                                    <p class="text-2xl font-bold" id="stat-total-students">0</p>
                                </div>
                            </div>
                        </div>
                        <div class="card">
                            <div class="flex items-center gap-3 p-4">
                                <div class="p-3 rounded-lg bg-yellow-100">
                                    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"
                                        fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                                        stroke-linejoin="round" class="text-yellow-600">
                                        <path d="M22 10v6M2 10l10-5 10 5-10 5z" />
                                        <path d="M6 12v5c3 3 9 3 12 0v-5" />
                                    </svg>
                                </div>
                                <div>
                                    <p class="text-sm" style="color: oklch(.708 0 0);" data-i18n="home.overallAverage">
                                        Overall Average</p>
                                    <p class="text-2xl font-bold" id="stat-overall-average">-</p>
                                </div>
                            </div>
                        </div>
                        <div class="card">
                            <div class="flex items-center gap-3 p-4">
                                <div class="p-3 rounded-lg bg-purple-100">
                                    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"
                                        fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                                        stroke-linejoin="round" class="text-purple-600">
                                        <path d="M12 20h9" />
                                        <path d="M16.5 3.5a2.12 2.12 0 0 1 3 3L7 19l-4 1 1-4Z" />
                                    </svg>
                                </div>
                                <div>
                                    <p class="text-sm" style="color: oklch(.708 0 0);" data-i18n="home.totalGrades">
                                        Total Grades</p>
                                    <p class="text-2xl font-bold" id="stat-total-grades">0</p>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="card">
                        <header class="mb-4 px-4 pt-4">
                            <h2 class="text-xl font-semibold" data-i18n="home.classOverview">Class Overview</h2>
                        </header>
                        <div id="class-overview-list" class="space-y-3 px-4 pb-4"></div>
                    </div>
                </section>

                <!-- Class View -->
                <section id="class-view" class="hidden mt-10">
                    <div class="card mb-6">
                        <header class="mb-4">
                            <h2 class="text-xl font-semibold mb-3">Class: <span id="current-class-name"></span></h2>

                            <!-- Year Tabs -->
                            <div id="year-selector" class="flex items-center gap-2 flex-wrap mb-3"></div>

                            <div class="flex flex-wrap gap-2">
                                <button id="add-student" class="btn-primary">
                                    <svg class="lucide lucide-user-plus" viewBox="0 0 24 24" fill="none"
                                        stroke="currentColor">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                            d="M16 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2" />
                                        <circle cx="8.5" cy="7" r="4" />
                                        <line x1="20" y1="8" x2="20" y2="14" />
                                        <line x1="23" y1="11" x2="17" y2="11" />
                                    </svg>
                                    <span data-i18n="class.addStudent">Add Student</span>
                                </button>
                                <button id="import-students-btn" class="btn-secondary">
                                    <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24"
                                        fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                                        stroke-linejoin="round">
                                        <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4" />
                                        <polyline points="17 8 12 3 7 8" />
                                        <line x1="12" x2="12" y1="3" y2="15" />
                                    </svg>
                                    <span data-i18n="class.importStudents">Import Students</span>
                                </button>
                                <button id="student-access-btn" class="btn-secondary">
                                    <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24"
                                        fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                                        stroke-linejoin="round">
                                        <path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71" />
                                        <path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71" />
                                    </svg>
                                    <span data-i18n="class.studentAccess">Student Access</span>
                                </button>
                            </div>
                        </header>

                        <!-- Subject Tabs -->
                        <section class="mb-4">
                            <div id="subject-tabs" class="flex items-center gap-2 flex-wrap"></div>
                        </section>

                        <!-- Class Stats -->
                        <section class="grid grid-cols-2 md:grid-cols-4 gap-4 mb-6">
                            <div class="stat-card p-4 rounded-lg border">
                                <p class="text-sm" style="color: oklch(.708 0 0);" data-i18n="class.classAverage">Class
                                    Average</p>
                                <p class="text-2xl font-bold" id="class-stat-average">-</p>
                            </div>
                            <div class="stat-card p-4 rounded-lg border">
                                <p class="text-sm" style="color: oklch(.708 0 0);" data-i18n="class.students">Students
                                </p>
                                <p class="text-2xl font-bold" id="class-stat-students">0</p>
                            </div>
                            <div class="stat-card p-4 rounded-lg border">
                                <p class="text-sm" style="color: oklch(.708 0 0);" data-i18n="class.totalGrades">Total
                                    Grades</p>
                                <p class="text-2xl font-bold" id="class-stat-grades">0</p>
                            </div>
                            <div class="stat-card p-4 rounded-lg border">
                                <p class="text-sm" style="color: oklch(.708 0 0);" data-i18n="class.passRate">Pass Rate
                                </p>
                                <p class="text-2xl font-bold" id="class-stat-pass-rate">-</p>
                            </div>
                        </section>

                        <section class="mb-4 flex gap-2">
                            <input type="text" id="search-students" class="input flex-1"
                                placeholder="Search by name or grade..."
                                data-i18n-placeholder="class.searchPlaceholder">
                            <select id="filter-category" class="select">
                                <option value="">All Categories</option>
                            </select>
                        </section>
                        <section class="overflow-x-auto">
                            <table class="table w-full">
                                <thead>
                                    <tr>
                                        <th data-i18n="table.lastName">Last Name</th>
                                        <th data-i18n="table.firstName">First Name</th>
                                        <th data-i18n="table.middleName">Middle Name</th>
                                        <th data-i18n="table.gradeCount"># Grades</th>
                                        <th data-i18n="table.average">Average</th>
                                        <th data-i18n="table.weighted">Weighted</th>
                                        <th data-i18n="table.finalGrade">Final Grade</th>
                                        <th data-i18n="table.actions">Actions</th>
                                    </tr>
                                </thead>
                                <tbody id="students-table"></tbody>
                            </table>
                        </section>
                    </div>
                </section>

                <!-- Student Detail View -->
                <section id="student-detail-view" class="hidden mt-10">
                    <div class="card mb-6">
                        <header class="flex justify-between items-center mb-4">
                            <div class="flex items-center gap-3">
                                <button id="back-to-class" class="btn-outline">
                                    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"
                                        fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                                        stroke-linejoin="round">
                                        <path d="m12 19-7-7 7-7" />
                                        <path d="M19 12H5" />
                                    </svg>
                                    <span data-i18n="student.back">Back</span>
                                </button>
                                <h2 class="text-xl font-semibold" id="student-detail-name"></h2>
                            </div>
                            <div class="flex gap-2">
                                <button id="student-detail-print" class="btn-outline">
                                    <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24"
                                        fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                                        stroke-linejoin="round">
                                        <polyline points="6 9 6 2 18 2 18 9"></polyline>
                                        <path d="M6 18H4a2 2 0 0 1-2-2v-5a2 2 0 0 1 2-2h16a2 2 0 0 1 2 2v5a2 2 0 0 1-2 2h-2"></path>
                                        <rect x="6" y="14" width="12" height="8"></rect>
                                    </svg>
                                    <span data-i18n="student.print">Print</span>
                                </button>
                                <button id="student-detail-add-grade" class="btn-primary">
                                    <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24"
                                        fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                                        stroke-linejoin="round">
                                        <path d="M5 12h14" />
                                        <path d="M12 5v14" />
                                    </svg>
                                    <span data-i18n="grade.addGrade">Add Grade</span>
                                </button>
                            </div>
                        </header>

                        <section class="p-7">
                            <div class="grid grid-cols-2 md:grid-cols-5 gap-4 mb-6">
                                <div class="stat-card p-4 rounded-lg border">
                                    <div class="flex justify-between items-start mb-2">
                                        <p class="text-sm" style="color: oklch(.708 0 0);" data-i18n="student.average">
                                            Average</p>
                                        <span id="student-stat-average-percent"></span>
                                    </div>
                                    <p class="text-2xl font-bold" id="student-stat-average">-</p>
                                </div>
                                <div class="stat-card p-4 rounded-lg border">
                                    <p class="text-sm" style="color: oklch(.708 0 0);" data-i18n="student.finalGrade">
                                        Final Grade</p>
                                    <p class="text-2xl font-bold" id="student-stat-final">-</p>
                                </div>
                                <div class="stat-card p-4 rounded-lg border">
                                    <p class="text-sm" style="color: oklch(.708 0 0);" data-i18n="student.trend">Trend
                                    </p>
                                    <p class="text-2xl font-bold flex items-center gap-1" id="student-stat-trend">-</p>
                                </div>
                                <div class="stat-card p-4 rounded-lg border">
                                    <p class="text-sm" style="color: oklch(.708 0 0);" data-i18n="student.gradeCount">
                                        Grade Count</p>
                                    <p class="text-2xl font-bold" id="student-stat-count">0</p>
                                </div>
                                <div class="stat-card p-4 rounded-lg border">
                                    <p class="text-sm" style="color: oklch(.708 0 0);" data-i18n="student.vsClassAvg">
                                        vs. Class Avg</p>
                                    <p class="text-2xl font-bold" id="student-stat-comparison">-</p>
                                </div>
                            </div>

                            <!-- Chart Container -->
                            <div class="chart-container mb-6" style="position: relative; height: 300px;">
                                <canvas id="student-grade-chart"></canvas>
                            </div>

                            <!-- Kategorie-Aufschlsselung -->
                            <div class="mb-6">
                                <h3 class="text-lg font-semibold mb-3" data-i18n="student.categoryBreakdown">Category
                                    Breakdown</h3>
                                <div id="category-breakdown"
                                    class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-3"></div>
                            </div>

                            <!-- Noten-Tabelle -->
                            <div>
                                <h3 class="text-lg font-semibold mb-3" data-i18n="student.gradeHistory">Grade History
                                </h3>

                                <!-- Search input for grades -->
                                <div class="mb-4">
                                    <input type="text" id="student-grades-search" class="input w-full"
                                        data-i18n-placeholder="student.searchGrades"
                                        placeholder="Noten durchsuchen...">
                                </div>

                                <div class="overflow-x-auto">
                                    <table class="table w-full">
                                        <thead>
                                            <tr>
                                                <th data-i18n="table.date">Date</th>
                                                <th data-i18n="table.category">Category</th>
                                                <th data-i18n="table.name">Name</th>
                                                <th data-i18n="table.grade">Grade</th>
                                                <th data-i18n="table.weight">Weight</th>
                                                <th data-i18n="table.actions">Actions</th>
                                            </tr>
                                        </thead>
                                        <tbody id="student-grades-table"></tbody>
                                    </table>
                                </div>
                            </div>
                        </section>
                    </div>
                </section>

                <!-- Dialogs -->
                <dialog id="edit-dialog" class="dialog w-full sm:max-w-[425px]" aria-labelledby="edit-dialog-title">
                    <div>
                        <header>
                            <h2 id="edit-dialog-title"></h2>
                        </header>
                        <section>
                            <form id="edit-form" class="form grid gap-4"></form>
                        </section>
                        <footer class="flex justify-end gap-2">
                            <button type="button" class="btn-outline" id="cancel-edit"
                                data-i18n="dialog.cancel">Cancel</button>
                            <button type="submit" class="btn-primary" form="edit-form"
                                data-i18n="dialog.save">Save</button>
                        </footer>
                        <button type="button" aria-label="Close dialog"
                            data-tooltip="Close dialog" data-i18n-tooltip="dialog.closeDialog" data-side="top">
                            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"
                                fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                                stroke-linejoin="round" class="lucide lucide-x-icon lucide-x">
                                <path d="M18 6 6 18" />
                                <path d="m6 6 12 12" />
                            </svg>
                        </button>
                    </div>
                </dialog>

                <dialog id="manage-categories-dialog" class="dialog w-full sm:max-w-[525px]"
                    aria-labelledby="manage-categories-title">
                    <div>
                        <header>
                            <h2 id="manage-categories-title" data-i18n="class.manageCategories">Manage Categories</h2>
                        </header>
                        <section>
                            <div class="tabs w-full" id="manage-categories-tabs">
                                <nav role="tablist" aria-orientation="horizontal" class="w-full">
                                    <button type="button" role="tab" id="tab-categories"
                                        aria-controls="panel-categories" aria-selected="true" tabindex="0"
                                        data-i18n="category.categories">Categories</button>
                                    <button type="button" role="tab" id="tab-percentage"
                                        aria-controls="panel-percentage" aria-selected="false" tabindex="0"
                                        data-i18n="category.gradeRanges">Grade
                                        Ranges</button>
                                    <button type="button" role="tab" id="tab-plusminus" aria-controls="panel-plusminus"
                                        aria-selected="false" tabindex="0" data-i18n="category.plusMinusSettings">+/~/-
                                        Settings</button>
                                </nav>

                                <div role="tabpanel" id="panel-categories" aria-labelledby="tab-categories"
                                    tabindex="-1" aria-selected="true">
                                    <div class="py-4">
                                        <div id="categories-list" class="space-y-2"></div>
                                    </div>
                                </div>

                                <div role="tabpanel" id="panel-percentage" aria-labelledby="tab-percentage"
                                    tabindex="-1" aria-selected="false" hidden>
                                    <div class="py-4">
                                        <p class="text-sm mb-4" style="color: oklch(.708 0 0);"
                                            data-i18n="category.gradeRangesHint">Define the percentage
                                            ranges for each grade. These are used when entering grades as percentages.
                                        </p>
                                        <div class="space-y-3" id="percentage-ranges-list">
                                            <div class="flex items-center gap-2">
                                                <span class="w-12 font-semibold">1</span>
                                                <input type="number" id="grade-1-min" min="0" max="100"
                                                    class="input w-20" value="85">
                                                <span>% -</span>
                                                <input type="number" id="grade-1-max" min="0" max="100"
                                                    class="input w-20" value="100">
                                                <span>%</span>
                                            </div>
                                            <div class="flex items-center gap-2">
                                                <span class="w-12 font-semibold">2</span>
                                                <input type="number" id="grade-2-min" min="0" max="100"
                                                    class="input w-20" value="70">
                                                <span>% -</span>
                                                <input type="number" id="grade-2-max" min="0" max="100"
                                                    class="input w-20" value="84">
                                                <span>%</span>
                                            </div>
                                            <div class="flex items-center gap-2">
                                                <span class="w-12 font-semibold">3</span>
                                                <input type="number" id="grade-3-min" min="0" max="100"
                                                    class="input w-20" value="55">
                                                <span>% -</span>
                                                <input type="number" id="grade-3-max" min="0" max="100"
                                                    class="input w-20" value="69">
                                                <span>%</span>
                                            </div>
                                            <div class="flex items-center gap-2">
                                                <span class="w-12 font-semibold">4</span>
                                                <input type="number" id="grade-4-min" min="0" max="100"
                                                    class="input w-20" value="40">
                                                <span>% -</span>
                                                <input type="number" id="grade-4-max" min="0" max="100"
                                                    class="input w-20" value="54">
                                                <span>%</span>
                                            </div>
                                            <div class="flex items-center gap-2">
                                                <span class="w-12 font-semibold">5</span>
                                                <input type="number" id="grade-5-min" min="0" max="100"
                                                    class="input w-20" value="0">
                                                <span>% -</span>
                                                <input type="number" id="grade-5-max" min="0" max="100"
                                                    class="input w-20" value="39">
                                                <span>%</span>
                                            </div>
                                        </div>
                                        <button id="save-percentage-ranges" class="btn-primary mt-4 w-full"
                                            data-i18n="category.saveRanges">Save
                                            Ranges</button>
                                    </div>
                                </div>

                                <div role="tabpanel" id="panel-plusminus" aria-labelledby="tab-plusminus" tabindex="-1"
                                    aria-selected="false" hidden>
                                    <div class="py-4">
                                        <p class="text-sm mb-3" style="color: oklch(.708 0 0);"
                                            data-i18n="category.plusMinusSettingsHint">Configure the percentage values for +/~/- grades. These values are used to calculate the grade average for categories with +/~/- grades.</p>
                                        <div class="space-y-3">
                                            <div class="flex items-center gap-3">
                                                <span class="text-2xl font-bold text-green-600 w-12 text-center">+</span>
                                                <div class="flex-1">
                                                    <label class="block text-sm mb-1" data-i18n="category.plusPercent">Plus percentage</label>
                                                    <div class="flex items-center gap-2">
                                                        <input type="number" id="plusminus-plus-percent" step="1" min="0"
                                                            max="100" class="input w-32" value="100">
                                                        <span class="text-sm">%</span>
                                                        <span class="text-xs" style="color: oklch(.708 0 0);" data-i18n="category.plusHint">(Excellent performance)</span>
                                                    </div>
                                                </div>
                                            </div>
                                            <div class="flex items-center gap-3">
                                                <span class="text-2xl font-bold text-yellow-600 w-12 text-center">~</span>
                                                <div class="flex-1">
                                                    <label class="block text-sm mb-1" data-i18n="category.neutralPercent">Neutral percentage</label>
                                                    <div class="flex items-center gap-2">
                                                        <input type="number" id="plusminus-neutral-percent" step="1" min="0"
                                                            max="100" class="input w-32" value="50">
                                                        <span class="text-sm">%</span>
                                                        <span class="text-xs" style="color: oklch(.708 0 0);" data-i18n="category.neutralHint">(Average performance)</span>
                                                    </div>
                                                </div>
                                            </div>
                                            <div class="flex items-center gap-3">
                                                <span class="text-2xl font-bold text-red-600 w-12 text-center">-</span>
                                                <div class="flex-1">
                                                    <label class="block text-sm mb-1" data-i18n="category.minusPercent">Minus percentage</label>
                                                    <div class="flex items-center gap-2">
                                                        <input type="number" id="plusminus-minus-percent" step="1" min="0"
                                                            max="100" class="input w-32" value="0">
                                                        <span class="text-sm">%</span>
                                                        <span class="text-xs" style="color: oklch(.708 0 0);" data-i18n="category.minusHint">(Poor performance)</span>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                        <button id="save-plusminus-settings" class="btn-primary mt-4 w-full"
                                            data-i18n="category.saveSettings">Save
                                            Settings</button>
                                    </div>
                                </div>
                            </div>
                        </section>
                        <footer class="flex justify-between items-center gap-2">
                            <button id="add-category" class="btn-secondary">
                                <svg class="lucide lucide-tag" viewBox="0 0 24 24" fill="none" stroke="currentColor">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                        d="M12.586 2.586A2 2 0 0 0 11.172 2H4a2 2 0 0 0-2 2v7.172a2 2 0 0 0 .586 1.414l8.704 8.704a2.426 2.426 0 0 0 3.42 0l6.58-6.58a2.426 2.426 0 0 0 0-3.42Z" />
                                    <circle cx="7.5" cy="15.5" r="1" />
                                </svg>
                                <span data-i18n="category.addCategory">Add Category</span>
                            </button>
                            <button type="button" class="btn-outline" id="close-manage-categories"
                                data-i18n="dialog.close">Close</button>
                        </footer>
                        <button type="button" aria-label="Close dialog" data-tooltip="Close dialog"
                            data-i18n-tooltip="dialog.closeDialog" data-side="top"
                            id="close-manage-categories-x">
                            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"
                                fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                                stroke-linejoin="round" class="lucide lucide-x-icon lucide-x">
                                <path d="M18 6 6 18" />
                                <path d="m6 6 12 12" />
                            </svg>
                        </button>
                    </div>
                </dialog>



                <dialog id="confirm-dialog" class="dialog w-full sm:max-w-[425px]"
                    aria-labelledby="confirm-dialog-title">
                    <div>
                        <header>
                            <h2 data-i18n="dialog.confirmation">Confirmation</h2>
                        </header>
                        <section>
                            <p id="confirm-message" class="mb-4"></p>
                        </section>
                        <footer class="flex justify-end gap-2">
                            <button type="button" class="btn-outline" id="cancel-action"
                                data-i18n="dialog.cancel">Cancel</button>
                            <button type="button" class="btn-destructive" id="confirm-action"
                                data-i18n="dialog.delete">Delete</button>
                        </footer>
                    </div>
                </dialog>

                <!-- Add Class Dialog -->
                <dialog id="add-class-dialog" class="dialog w-full sm:max-w-[425px]"
                    aria-labelledby="add-class-dialog-title">
                    <div>
                        <header>
                            <h2 id="add-class-dialog-title" data-i18n="class.addClass">Add Class</h2>
                        </header>
                        <section>
                            <form id="add-class-form" class="form grid gap-4">
                                <div class="grid gap-2">
                                    <label for="class-name-input" class="block mb-2"
                                        data-i18n="class.classNameLabel">Class Name</label>
                                    <input type="text" id="class-name-input" name="name" class="input w-full" required>
                                </div>
                            </form>
                        </section>
                        <footer class="flex justify-end gap-2">
                            <button type="button" class="btn-outline" id="cancel-add-class"
                                data-i18n="dialog.cancel">Cancel</button>
                            <button type="submit" class="btn-primary" form="add-class-form"
                                data-i18n="dialog.add">Add</button>
                        </footer>
                        <button type="button" aria-label="Close dialog" onclick="this.closest('dialog').close()">
                            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"
                                fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                                stroke-linejoin="round">
                                <path d="M18 6 6 18" />
                                <path d="m6 6 12 12" />
                            </svg>
                        </button>
                    </div>
                </dialog>

                <!-- Student Access Dialog -->
                <dialog id="student-access-dialog" class="dialog w-full sm:max-w-[600px]"
                    aria-labelledby="student-access-dialog-title" onclick="if (event.target === this) this.close()">
                    <div>
                        <header>
                            <h2 id="student-access-dialog-title" data-i18n="class.studentAccess">Student Access</h2>
                            <p class="text-sm" style="color: oklch(.708 0 0);" data-i18n="class.studentAccessSubtitle">
                                Manage access link for students</p>
                        </header>
                        <section>
                            <div id="student-access-content" class="py-2">
                                <div class="flex items-center justify-center p-8">
                                    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"
                                        fill="none" stroke="currentColor" stroke-width="2" class="animate-spin">
                                        <path d="M21 12a9 9 0 1 1-6.219-8.56" />
                                    </svg>
                                </div>
                            </div>
                        </section>
                        <footer class="flex justify-end gap-2">
                            <button type="button" class="btn-outline" id="close-student-access"
                                data-i18n="dialog.close">Close</button>
                        </footer>
                        <button type="button" aria-label="Close dialog" onclick="this.closest('dialog').close()"
                            data-tooltip="Close dialog" data-i18n-tooltip="dialog.closeDialog" data-side="top">
                            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"
                                fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                                stroke-linejoin="round">
                                <path d="M18 6 6 18" />
                                <path d="m6 6 12 12" />
                            </svg>
                        </button>
                    </div>
                </dialog>

                <!-- Add Student Dialog -->
                <dialog id="add-student-dialog" class="dialog w-full sm:max-w-[425px]"
                    aria-labelledby="add-student-dialog-title">
                    <div>
                        <header>
                            <h2 id="add-student-dialog-title" data-i18n="class.addStudent">Add Student</h2>
                        </header>
                        <section>
                            <form id="add-student-form" class="form grid gap-4">
                                <div class="grid gap-2">
                                    <label for="student-firstname-input" class="block mb-2"
                                        data-i18n="student.firstName">First Name</label>
                                    <input type="text" id="student-firstname-input" name="firstName" class="input w-full"
                                        required>
                                </div>
                                <div class="grid gap-2">
                                    <label for="student-middlename-input" class="block mb-2"
                                        data-i18n="student.middleName">Middle Name</label>
                                    <input type="text" id="student-middlename-input" name="middleName" class="input w-full">
                                    <p class="text-sm" style="color: oklch(.708 0 0);"
                                        data-i18n="student.middleNameHint">Optional: if the student has a second first name.</p>
                                </div>
                                <div class="grid gap-2">
                                    <label for="student-lastname-input" class="block mb-2"
                                        data-i18n="student.lastName">Last Name</label>
                                    <input type="text" id="student-lastname-input" name="lastName" class="input w-full"
                                        required>
                                </div>
                            </form>
                        </section>
                        <footer class="flex justify-end gap-2">
                            <button type="button" class="btn-outline" id="cancel-add-student"
                                data-i18n="dialog.cancel">Cancel</button>
                            <button type="submit" class="btn-primary" form="add-student-form"><svg
                                    xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"
                                    fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                                    stroke-linejoin="round" class="lucide lucide-user-plus-icon lucide-user-plus">
                                    <path d="M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2" />
                                    <circle cx="9" cy="7" r="4" />
                                    <line x1="19" x2="19" y1="8" y2="14" />
                                    <line x1="22" x2="16" y1="11" y2="11" />
                                </svg> <span data-i18n="dialog.add">Add</span></button>
                        </footer>
                        <button type="button" aria-label="Close dialog" onclick="this.closest('dialog').close()">
                            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"
                                fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                                stroke-linejoin="round">
                                <path d="M18 6 6 18" />
                                <path d="m6 6 12 12" />
                            </svg>
                        </button>
                    </div>
                </dialog>

                <!-- Import Students Dialog -->
                <dialog id="import-students-dialog" class="dialog w-full sm:max-w-[525px]"
                    aria-labelledby="import-students-dialog-title">
                    <div>
                        <header>
                            <h2 id="import-students-dialog-title" data-i18n="class.importStudents">Import Students</h2>
                        </header>
                        <section>
                            <div class="grid gap-4">
                                <div class="grid gap-2">
                                    <label for="import-students-file" class="block mb-2"
                                        data-i18n="import.selectStudentFile">Select CSV or JSON file</label>
                                    <input type="file" id="import-students-file" class="input" accept=".csv,.json">
                                    <p class="text-sm" style="color: oklch(.708 0 0);"
                                        data-i18n="import.csvJsonHint">CSV (FirstName,MiddleName,LastName) or JSON array with firstName/middleName/lastName fields.</p>
                                </div>
                                <div id="import-students-preview" class="hidden">
                                    <p class="text-sm font-medium mb-2" id="import-students-count"></p>
                                    <div class="overflow-x-auto border rounded-lg" style="max-height: 300px; overflow-y: auto;">
                                        <table class="table w-full text-sm">
                                            <thead>
                                                <tr>
                                                    <th data-i18n="table.lastName">Last Name</th>
                                                    <th data-i18n="table.firstName">First Name</th>
                                                    <th data-i18n="table.middleName">Middle Name</th>
                                                </tr>
                                            </thead>
                                            <tbody id="import-students-table"></tbody>
                                        </table>
                                    </div>
                                </div>
                            </div>
                        </section>
                        <footer class="flex justify-end gap-2">
                            <button type="button" class="btn-outline" id="cancel-import-students"
                                data-i18n="dialog.cancel">Cancel</button>
                            <button type="button" class="btn-primary" id="confirm-import-students" disabled>
                                <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24"
                                    fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                                    stroke-linejoin="round">
                                    <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4" />
                                    <polyline points="17 8 12 3 7 8" />
                                    <line x1="12" x2="12" y1="3" y2="15" />
                                </svg>
                                <span data-i18n="import.importStudents">Import</span>
                            </button>
                        </footer>
                        <button type="button" aria-label="Close dialog" onclick="this.closest('dialog').close()"
                            data-tooltip="Close dialog" data-i18n-tooltip="dialog.closeDialog" data-side="top">
                            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"
                                fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                                stroke-linejoin="round">
                                <path d="M18 6 6 18" />
                                <path d="m6 6 12 12" />
                            </svg>
                        </button>
                    </div>
                </dialog>
            </main>
        </div>
    </div>

    <script src="/static/scripts/security.js"></script>
    <script src="/static/scripts/data.js"></script>
    <script src="/static/scripts/i18n.js"></script>
    <script src="/static/scripts/utils.js"></script>
    <script src="/static/scripts/storage.js"></script>
    <script src="/static/scripts/ui.js"></script>
    <script src="/static/scripts/dataManagement.js"></script>
    <script src="/static/scripts/render.js"></script>
    <script src="/static/scripts/pdfExport.js"></script>
    <script src="/static/scripts/exportImport.js"></script>
    <script src="/static/scripts/tutorial.js"></script>
    <script src="/static/scripts/eventListeners.js"></script>

    <script>
        document.addEventListener('DOMContentLoaded', function () {
            // Setup theme buttons
            const setupThemeLight = document.getElementById('setup-theme-light');
            const setupThemeDark = document.getElementById('setup-theme-dark');

            const updateThemeButtons = () => {
                const isDark = document.documentElement.classList.contains('dark');
                if (isDark) {
                    setupThemeDark.classList.remove('btn-outline');
                    setupThemeDark.classList.add('btn-primary');
                    setupThemeLight.classList.remove('btn-primary');
                    setupThemeLight.classList.add('btn-outline');
                } else {
                    setupThemeLight.classList.remove('btn-outline');
                    setupThemeLight.classList.add('btn-primary');
                    setupThemeDark.classList.remove('btn-primary');
                    setupThemeDark.classList.add('btn-outline');
                }
            };

            // Initialize button states
            updateThemeButtons();

            setupThemeLight.addEventListener('click', () => {
                document.dispatchEvent(new CustomEvent('basecoat:theme', { detail: { mode: 'light' } }));
                updateThemeButtons();
            });

            setupThemeDark.addEventListener('click', () => {
                document.dispatchEvent(new CustomEvent('basecoat:theme', { detail: { mode: 'dark' } }));
                updateThemeButtons();
            });

            // Setup language buttons
            const setupLangEn = document.getElementById('setup-lang-en');
            const setupLangDe = document.getElementById('setup-lang-de');

            const updateLangButtons = () => {
                const lang = I18n.getCurrentLanguage();
                if (lang === 'de') {
                    setupLangDe.classList.remove('btn-outline');
                    setupLangDe.classList.add('btn-primary');
                    setupLangEn.classList.remove('btn-primary');
                    setupLangEn.classList.add('btn-outline');
                } else {
                    setupLangEn.classList.remove('btn-outline');
                    setupLangEn.classList.add('btn-primary');
                    setupLangDe.classList.remove('btn-primary');
                    setupLangDe.classList.add('btn-outline');
                }
            };

            updateLangButtons();

            setupLangEn.addEventListener('click', () => {
                I18n.setLanguage('en');
                updateLangButtons();
                I18n.applyI18nToDOM();
            });

            setupLangDe.addEventListener('click', () => {
                I18n.setLanguage('de');
                updateLangButtons();
                I18n.applyI18nToDOM();
            });

            // Logout button
            const logoutHandler = async () => {
                const btn = document.getElementById('logout-btn');
                setButtonLoading(btn, true, t('loading.starting'));
                try {
                    await fetch('/api/logout', { method: 'POST' });
                    window.location.href = '/login';
                } catch (error) {
                    console.error('Logout error:', error);
                    window.location.href = '/login';
                }
            };

            document.getElementById('logout-btn').addEventListener('click', logoutHandler);

            // Profile dialog handlers
            const profileDialog = document.getElementById('profile-dialog');
            const deleteAccountDialog = document.getElementById('delete-account-dialog');

            const openProfileDialog = () => {
                // Load current values
                document.getElementById('profile-teacher-name').value = appData.teacherName || '';
                document.getElementById('profile-school').value = appData.school || '';
                document.getElementById('profile-language').value = I18n.getCurrentLanguage();
                profileDialog.showModal();
            };

            document.getElementById('profile-btn').addEventListener('click', openProfileDialog);

            document.getElementById('cancel-profile').addEventListener('click', () => {
                profileDialog.close();
            });

            document.getElementById('save-profile').addEventListener('click', async () => {
                const btn = document.getElementById('save-profile');
                const teacherName = document.getElementById('profile-teacher-name').value.trim();
                const school = document.getElementById('profile-school').value.trim();
                const language = document.getElementById('profile-language').value;

                // Validate teacher name
                if (teacherName && teacherName.length > 100) {
                    showAlertDialog(t('validation.inputTooLong', { max: 100 }));
                    return;
                }

                setButtonLoading(btn, true, t('error.saving'));

                // Update appData
                appData.teacherName = teacherName;
                appData.school = school;
                appData.language = language;

                // Apply language change
                I18n.setLanguage(language);
                I18n.applyI18nToDOM();

                // Update greeting display
                if (teacherName) {
                    document.getElementById('teacher-greeting').textContent = escapeHtml(teacherName);
                } else {
                    document.getElementById('teacher-greeting').textContent = window.currentUser.username;
                }

                // Save to server
                saveData(t('toast.profileSaved'), 'success');
                setButtonLoading(btn, false);
                profileDialog.close();
            });

            // Clear data button in profile
            const clearStorageDialog = document.getElementById('clear-storage-dialog');

            document.getElementById('profile-clear-data').addEventListener('click', () => {
                profileDialog.close();
                clearStorageDialog.showModal();
            });

            document.getElementById('cancel-clear-storage').addEventListener('click', () => {
                clearStorageDialog.close();
            });

            document.getElementById('confirm-clear-storage').addEventListener('click', async () => {
                const btn = document.getElementById('confirm-clear-storage');
                setButtonLoading(btn, true, t('loading.starting'));
                try {
                    // Reset appData to defaults
                    appData = {
                        teacherName: "",
                        currentClassId: null,
                        classes: [],
                        categories: [],
                        students: [],
                        gradeRanges: {
                            1: { min: 85, max: 100 },
                            2: { min: 70, max: 84 },
                            3: { min: 55, max: 69 },
                            4: { min: 40, max: 54 },
                            5: { min: 0, max: 39 }
                        },
                        plusMinusSettings: {
                            startGrade: 3,
                            plusValue: 0.5,
                            minusValue: 0.5
                        },
                        school: ""
                    };

                    // Save empty data to server
                    await fetch('/api/data', {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify(appData)
                    });

                    // Reload page to apply changes
                    location.reload();
                } catch (error) {
                    console.error('Clear data error:', error);
                    setButtonLoading(btn, false);
                    showAlertDialog(t('error.somethingWrong'));
                    clearStorageDialog.close();
                }
            });

            // Delete account button
            document.getElementById('profile-delete-account').addEventListener('click', () => {
                profileDialog.close();
                deleteAccountDialog.showModal();
            });

            document.getElementById('cancel-delete-account').addEventListener('click', () => {
                deleteAccountDialog.close();
            });

            document.getElementById('confirm-delete-account').addEventListener('click', async () => {
                const btn = document.getElementById('confirm-delete-account');
                setButtonLoading(btn, true, t('loading.starting'));
                try {
                    const response = await fetch('/api/account', { method: 'DELETE' });
                    const data = await response.json();

                    if (response.ok) {
                        window.location.href = '/login';
                    } else {
                        setButtonLoading(btn, false);
                        showAlertDialog(data.message ? t(data.message) : t('error.somethingWrong'));
                        deleteAccountDialog.close();
                    }
                } catch (error) {
                    console.error('Delete account error:', error);
                    setButtonLoading(btn, false);
                    showAlertDialog(t('error.somethingWrong'));
                    deleteAccountDialog.close();
                }
            });
        });
    </script>

    <footer class="fixed bottom-0 left-0 right-0 py-2 text-center text-xs" style="color: oklch(.708 0 0);">
        <p>Entwickelt von Fabian Murauer - Semester Abschlussprojekt 2025</p>
    </footer>
    <script>
        if ('serviceWorker' in navigator) {
            navigator.serviceWorker.register('/service-worker.js', { scope: '/' });
        }
    </script>
</body>

</html>